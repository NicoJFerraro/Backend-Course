<h2>Products (Página {{page}} / {{totalPages}})</h2>
{{#if error}}
  <div class="error">{{error}}</div>
{{/if}}
<div class="product-grid">
  {{#each products}}
  <div class="product-card">
    <h3>{{this.title}}</h3>
    <p>{{this.description}}</p>
    <p><strong>Precio:</strong> ${{this.price}}</p>
    <p><strong>Categoría:</strong> {{this.category}}</p>
    <p><strong>Stock:</strong> {{this.stock}}</p>
    <a href="/products/{{this._id}}">Ver detalle</a>
    <button class="add-btn" data-id="{{this._id}}">Agregar al carrito</button>
  </div>
  {{/each}}
</div>
<div class="pagination">
  {{#if hasPrevPage}}<a href="{{prevLink}}">⬅️ Anterior</a>{{/if}}
  {{#if hasNextPage}}<a href="{{nextLink}}">Siguiente ➡️</a>{{/if}}
</div>
<script>
  const cartId = '{{cartId}}';
  document.querySelectorAll('.add-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const pid = btn.getAttribute('data-id');
      try {
        const res = await fetch(`/api/carts/${cartId}/products/${pid}`, { method: 'POST', headers: { 'Content-Type': 'application/json' } });
        if (!res.ok) throw new Error('Error agregando producto');
        btn.textContent = 'Agregado';
      } catch (e) { alert(e.message); }
    });
  });
</script>
